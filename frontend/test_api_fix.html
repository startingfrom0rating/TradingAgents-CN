<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #409eff;
            margin-bottom: 10px;
        }
        .test-button {
            background: #409eff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .test-button:hover {
            background: #337ecc;
        }
        .test-button:disabled {
            background: #c0c4cc;
            cursor: not-allowed;
        }
        .result-box {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { color: #67c23a; }
        .error { color: #f56c6c; }
        .warning { color: #e6a23c; }
        .info { color: #909399; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ”§ APIä¿®å¤æµ‹è¯•</h1>
        <p>æµ‹è¯•ä¿®å¤åçš„APIè·¯å¾„æ˜¯å¦æ­£ç¡®</p>
    </div>

    <div class="container">
        <h3>ğŸ§ª APIè·¯å¾„æµ‹è¯•</h3>
        <button class="test-button" onclick="testApiPaths()">æµ‹è¯•APIè·¯å¾„</button>
        <div id="pathResult" class="result-box" style="display: none;"></div>
    </div>

    <div class="container">
        <h3>ğŸ“Š å¤šæ•°æ®æºAPIæµ‹è¯•</h3>
        <button class="test-button" onclick="testMultiSourceApis()">æµ‹è¯•å¤šæ•°æ®æºAPI</button>
        <div id="multiSourceResult" class="result-box" style="display: none;"></div>
    </div>

    <script>
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const className = type;
            return `<span class="${className}">[${timestamp}] ${message}</span><br>`;
        }

        function showResult(elementId, content) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.innerHTML = content;
        }

        function appendResult(elementId, content) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.innerHTML += content;
        }

        async function testApiPaths() {
            showResult('pathResult', log('å¼€å§‹æµ‹è¯•APIè·¯å¾„...', 'info'));
            
            // æµ‹è¯•ä¸åŒçš„APIè·¯å¾„æ ¼å¼
            const testUrls = [
                '/api/sync/multi-source/sources/status',
                'http://localhost:3000/api/sync/multi-source/sources/status',
                'http://localhost:8000/api/sync/multi-source/sources/status'
            ];
            
            for (const url of testUrls) {
                try {
                    appendResult('pathResult', log(`æµ‹è¯•URL: ${url}`, 'info'));
                    
                    const response = await fetch(url, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        appendResult('pathResult', log(`âœ… æˆåŠŸ: ${response.status} - ${JSON.stringify(data).substring(0, 100)}...`, 'success'));
                    } else {
                        appendResult('pathResult', log(`âŒ å¤±è´¥: ${response.status} ${response.statusText}`, 'error'));
                    }
                } catch (error) {
                    appendResult('pathResult', log(`âŒ é”™è¯¯: ${error.message}`, 'error'));
                }
                
                // çŸ­æš‚å»¶è¿Ÿ
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            appendResult('pathResult', log('APIè·¯å¾„æµ‹è¯•å®Œæˆ', 'info'));
        }

        async function testMultiSourceApis() {
            showResult('multiSourceResult', log('å¼€å§‹æµ‹è¯•å¤šæ•°æ®æºAPI...', 'info'));
            
            const apis = [
                {
                    name: 'æ•°æ®æºçŠ¶æ€',
                    url: '/api/sync/multi-source/sources/status',
                    method: 'GET'
                },
                {
                    name: 'åŒæ­¥çŠ¶æ€',
                    url: '/api/sync/multi-source/status',
                    method: 'GET'
                },
                {
                    name: 'åŒæ­¥å»ºè®®',
                    url: '/api/sync/multi-source/recommendations',
                    method: 'GET'
                }
            ];
            
            for (const api of apis) {
                try {
                    appendResult('multiSourceResult', log(`æµ‹è¯•: ${api.name} (${api.method} ${api.url})`, 'info'));
                    
                    const response = await fetch(api.url, {
                        method: api.method,
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        appendResult('multiSourceResult', log(`âœ… ${api.name}: æˆåŠŸ`, 'success'));
                        
                        // æ˜¾ç¤ºå…³é”®ä¿¡æ¯
                        if (api.name === 'æ•°æ®æºçŠ¶æ€' && data.data) {
                            appendResult('multiSourceResult', log(`   æ•°æ®æºæ•°é‡: ${data.data.length}`, 'info'));
                            data.data.forEach(source => {
                                const status = source.available ? 'å¯ç”¨' : 'ä¸å¯ç”¨';
                                appendResult('multiSourceResult', log(`   - ${source.name}: ${status} (ä¼˜å…ˆçº§: ${source.priority})`, 'info'));
                            });
                        } else if (api.name === 'åŒæ­¥çŠ¶æ€' && data.data) {
                            appendResult('multiSourceResult', log(`   çŠ¶æ€: ${data.data.status}`, 'info'));
                            appendResult('multiSourceResult', log(`   æ€»æ•°: ${data.data.total}, é”™è¯¯: ${data.data.errors}`, 'info'));
                        } else if (api.name === 'åŒæ­¥å»ºè®®' && data.data) {
                            if (data.data.primary_source) {
                                appendResult('multiSourceResult', log(`   æ¨èä¸»æ•°æ®æº: ${data.data.primary_source.name}`, 'info'));
                            }
                            if (data.data.suggestions && data.data.suggestions.length > 0) {
                                appendResult('multiSourceResult', log(`   å»ºè®®æ•°é‡: ${data.data.suggestions.length}`, 'info'));
                            }
                        }
                    } else {
                        appendResult('multiSourceResult', log(`âŒ ${api.name}: ${response.status} ${response.statusText}`, 'error'));
                    }
                } catch (error) {
                    appendResult('multiSourceResult', log(`âŒ ${api.name}: ${error.message}`, 'error'));
                }
                
                // çŸ­æš‚å»¶è¿Ÿ
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            appendResult('multiSourceResult', log('å¤šæ•°æ®æºAPIæµ‹è¯•å®Œæˆ', 'info'));
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºå½“å‰é…ç½®
        window.onload = function() {
            console.log('å½“å‰é¡µé¢URL:', window.location.href);
            console.log('æµ‹è¯•ç¯å¢ƒ: å‰ç«¯å¼€å‘æœåŠ¡å™¨ (é€šå¸¸æ˜¯ http://localhost:3000)');
            console.log('åç«¯APIæœåŠ¡å™¨: http://localhost:8000');
            console.log('Viteä»£ç†é…ç½®: /api -> http://localhost:8000');
        };
    </script>
</body>
</html>
